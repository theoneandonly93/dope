(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[133],{618:function(e,t,s){Promise.resolve().then(s.bind(s,3918))},3918:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var a=s(7437),r=s(2265),l=s(1396),i=s.n(l),n=s(9265),c=s(3861);function d(){let{address:e}=(0,n.Os)(),[t,s]=(0,r.useState)(""),[l,d]=(0,r.useState)(!1),[o,h]=(0,r.useState)(!1),[x,u]=(0,r.useState)(180),[p,m]=(0,r.useState)("walletpay"),[g,v]=(0,r.useState)("purple"),[w,N]=(0,r.useState)(null),[b,j]=(0,r.useState)([]),[y,f]=(0,r.useState)(""),[S,k]=(0,r.useState)(""),[C,I]=(0,r.useState)(""),[_,A]=(0,r.useState)(""),[P,E]=(0,r.useState)(0),[O,U]=(0,r.useState)(!1);(0,r.useEffect)(()=>{try{var e;s((null===(e=(0,c.h8)())||void 0===e?void 0:e.name)||"")}catch(e){}try{let e=localStorage.getItem("dope_card_theme");("teal"===e||"orange"===e||"purple"===e)&&v(e)}catch(e){}try{let e=JSON.parse(localStorage.getItem("dope_blocked_merchants")||"[]");Array.isArray(e)&&j(e.filter(e=>"string"==typeof e))}catch(e){}try{let e=localStorage.getItem("dope_card_design");if(e){let t=JSON.parse(e);t&&"string"==typeof t.bg&&N(t)}}catch(e){}},[]),(0,r.useEffect)(()=>{let t=async()=>{if(e){U(!0);try{let t=await fetch("/api/card/balance?pubkey=".concat(e),{cache:"no-store"}),s=await t.json();(null==s?void 0:s.ok)&&E(Number(s.balance||0))}catch(e){}U(!1)}};t();let s=setInterval(t,1e4);return()=>clearInterval(s)},[e]);let R=t||(e?"".concat(e.slice(0,4),"…").concat(e.slice(-4)):"Unknown"),z=(0,r.useMemo)(()=>{if(!e)return"";let t=e.replace(/\s+/g,"");return"".concat(t.slice(0,6)," ").concat("•".repeat(4)," ").concat("•".repeat(4)," ").concat(t.slice(-4))},[e]);return(0,a.jsxs)("div",{className:"space-y-6 pb-24",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"Virtual Card"}),(0,a.jsxs)("div",{className:"rounded-2xl p-5 border border-white/10",style:{background:(null==w?void 0:w.bg)||("teal"===g?"linear-gradient(135deg, rgba(0,180,160,0.25), rgba(20,60,80,0.35))":"orange"===g?"linear-gradient(135deg, rgba(255,170,60,0.28), rgba(90,60,20,0.35))":"linear-gradient(135deg, rgba(165,140,255,0.25), rgba(60,60,120,0.35))")},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("img",{src:"/dopelganga.svg",alt:"dopelganga",className:"h-5 w-auto opacity-90"}),(0,a.jsx)("div",{className:"text-xs px-2 py-1 rounded-full ".concat(o?"bg-red-500/20 text-red-300":"bg-white/10 text-white/80"),children:o?"Frozen":"Active"})]}),(0,a.jsx)("div",{className:"mt-6 font-mono text-lg tracking-widest select-all",children:l&&e?e:z||"—"}),(0,a.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-white/80",children:[(0,a.jsx)("div",{className:"text-[11px] uppercase opacity-70",children:"Cardholder"}),(0,a.jsx)("div",{className:"font-semibold",children:R})]}),(0,a.jsxs)("div",{className:"text-white/80 text-right",children:[(0,a.jsx)("div",{className:"text-[11px] uppercase opacity-70",children:"Network"}),(0,a.jsx)("div",{className:"font-semibold",children:"DOPE"})]})]})]}),(0,a.jsxs)("div",{className:"glass rounded-2xl p-4 border border-white/10",children:[(0,a.jsx)("div",{className:"text-xs text-white/60",children:"Card Balance"}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[O?"…":P.toFixed(2)," ",(0,a.jsx)("span",{className:"text-sm text-white/60",children:"USDC"})]}),(0,a.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,a.jsx)(i(),{href:"/wallet/card/topup",className:"btn",children:"Top Up"}),(0,a.jsx)(i(),{href:"/wallet/card",className:"btn",children:"View Activity"})]})]}),(0,a.jsxs)("div",{className:"glass rounded-2xl p-4 border border-white/10 space-y-3",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"btn",onClick:()=>d(e=>!e),children:l?"Hide Details":"Show Details"}),(0,a.jsx)("button",{className:"btn",onClick:()=>h(e=>!e),children:o?"Unfreeze":"Freeze"})]}),(0,a.jsx)("div",{className:"text-xs text-white/60",children:"This is a virtual display linked to your wallet address for easy sharing and receiving. Never share your seed phrase or secret key."}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i(),{href:"/wallet/receive",className:"btn",children:"Receive"}),(0,a.jsx)(i(),{href:"/wallet/send",className:"btn",children:"Send"}),(0,a.jsx)(i(),{href:"/wallet/card/topup",className:"btn",children:"Top Up"}),(0,a.jsx)(i(),{href:"/wallet/card",className:"btn",children:"Card"})]}),e&&(0,a.jsxs)("div",{className:"pt-3",children:[(0,a.jsx)("div",{className:"text-sm font-semibold mb-2",children:"Quick Receive"}),(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("img",{src:"https://api.qrserver.com/v1/create-qr-code/?size=".concat(x,"x").concat(x,"&data=").concat(encodeURIComponent(e)),alt:"Wallet QR",width:x,height:x,className:"rounded bg-white p-2"}),(0,a.jsxs)("div",{className:"text-xs text-white/70 leading-5",children:["Scan to receive to your address. You can also share the address directly.",(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,a.jsx)("label",{className:"opacity-80",children:"Size"}),(0,a.jsxs)("select",{className:"bg-white/5 border border-white/10 rounded px-2 py-1",value:x,onChange:e=>u(parseInt(e.target.value)||180),children:[(0,a.jsx)("option",{value:160,children:"160"}),(0,a.jsx)("option",{value:180,children:"180"}),(0,a.jsx)("option",{value:200,children:"200"}),(0,a.jsx)("option",{value:240,children:"240"})]})]})]})]})]})]}),(0,a.jsxs)("div",{className:"glass rounded-2xl p-4 border border-white/10 space-y-4",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:"Manage Card"}),(0,a.jsx)("div",{className:"scroll-x-invisible -mx-1 px-1",children:(0,a.jsxs)("div",{className:"flex gap-2 min-w-0",children:[(0,a.jsx)("button",{className:"px-3 py-2 rounded-lg whitespace-nowrap ".concat("walletpay"===p?"bg-white/10":""),onClick:()=>m("walletpay"),children:"Add card to Wallet pay"}),(0,a.jsx)("button",{className:"px-3 py-2 rounded-lg whitespace-nowrap ".concat("design"===p?"bg-white/10":""),onClick:()=>m("design"),children:"Design new card"}),(0,a.jsx)("button",{className:"px-3 py-2 rounded-lg whitespace-nowrap ".concat("blocked"===p?"bg-white/10":""),onClick:()=>m("blocked"),children:"Blocked Businesses"}),(0,a.jsx)("button",{className:"px-3 py-2 rounded-lg whitespace-nowrap ".concat("pin"===p?"bg-white/10":""),onClick:()=>m("pin"),children:"Change PIN"}),(0,a.jsx)("button",{className:"px-3 py-2 rounded-lg whitespace-nowrap ".concat("support"===p?"bg-white/10":""),onClick:()=>m("support"),children:"Get card support"})]})}),"walletpay"===p&&(0,a.jsxs)("div",{className:"text-sm text-white/80 space-y-2",children:[(0,a.jsx)("div",{children:"Add this virtual card to your device wallet for quick access."}),(0,a.jsx)("div",{className:"text-xs text-white/60",children:"Integration coming soon. For now, use the Share button on your device to save the address."}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"btn",onClick:async()=>{if(e){try{await navigator.clipboard.writeText(e)}catch(e){}A("Address copied"),setTimeout(()=>A(""),1200)}},children:"Copy address"}),_&&(0,a.jsx)("div",{className:"text-xs text-green-400 self-center",children:_})]})]}),"design"===p&&(0,a.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,a.jsx)("div",{className:"text-white/80",children:"Choose a style"}),(0,a.jsx)("div",{className:"text-xs text-white/60",children:"Open the designer to browse Classic ($5) and Metal ($50) styles."}),(0,a.jsx)(i(),{href:"/card/design",className:"btn",children:"Open Designer"}),w&&(0,a.jsxs)("div",{className:"text-xs text-white/60",children:["Current: ",w.name," (",w.type,") — $",w.price]})]}),"blocked"===p&&(0,a.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,a.jsx)("div",{className:"text-white/80",children:"Blocked Businesses"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{value:y,onChange:e=>f(e.target.value),placeholder:"Business name or domain",className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 outline-none"}),(0,a.jsx)("button",{className:"btn",onClick:()=>{let e=y.trim();if(!e)return;let t=Array.from(new Set([...b||[],e]));j(t),f("");try{localStorage.setItem("dope_blocked_merchants",JSON.stringify(t))}catch(e){}},children:"Add"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[0===b.length&&(0,a.jsx)("div",{className:"text-white/60",children:"No blocked businesses."}),b.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 rounded border border-white/10",children:[(0,a.jsx)("div",{className:"truncate max-w-[70%]",children:e}),(0,a.jsx)("button",{className:"text-xs underline text-white/70",onClick:()=>{let e=b.filter((e,s)=>s!==t);j(e);try{localStorage.setItem("dope_blocked_merchants",JSON.stringify(e))}catch(e){}},children:"Remove"})]},e+String(t)))]})]}),"pin"===p&&(0,a.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,a.jsx)("div",{className:"text-white/80",children:"Change PIN"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)("input",{type:"password",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,placeholder:"New PIN",value:S,onChange:e=>k(e.target.value.replace(/[^0-9]/g,"")),className:"bg-white/5 border border-white/10 rounded-lg px-3 py-2 outline-none"}),(0,a.jsx)("input",{type:"password",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,placeholder:"Confirm PIN",value:C,onChange:e=>I(e.target.value.replace(/[^0-9]/g,"")),className:"bg-white/5 border border-white/10 rounded-lg px-3 py-2 outline-none"})]}),(0,a.jsx)("button",{className:"btn",onClick:()=>{if(A(""),!S||S!==C||S.length<4){A("Enter matching 4-6 digit PIN");return}try{localStorage.setItem("dope_card_pin_set","1")}catch(e){}A("PIN updated on this device"),k(""),I(""),setTimeout(()=>A(""),1500)},children:"Update PIN"}),_&&(0,a.jsx)("div",{className:"text-xs text-green-400",children:_}),(0,a.jsx)("div",{className:"text-xs text-white/60",children:"PIN is stored locally for UI actions only."})]}),"support"===p&&(0,a.jsxs)("div",{className:"space-y-2 text-sm text-white/80",children:[(0,a.jsx)("div",{children:"Need help with your card?"}),(0,a.jsx)("div",{className:"text-white/60 text-xs",children:"For issues with your virtual card UI, contact support via the app store listing or email support@example.com."})]})]}),!e&&(0,a.jsxs)("div",{className:"text-white/70 text-sm",children:["No wallet yet. ",(0,a.jsx)(i(),{href:"/get-started",className:"underline",children:"Create one"}),"."]})]})}},9265:function(e,t,s){"use strict";s.d(t,{Ek:function(){return h},Os:function(){return o},nS:function(){return d}});var a=s(7437),r=s(2265),l=s(8870),i=s.n(l),n=s(3861);let c=(0,r.createContext)(null);function d(e){let{children:t}=e,[l,d]=(0,r.useState)(null),[o,h]=(0,r.useState)(null),[x,u]=(0,r.useState)((0,n.Ru)()),[p,m]=(0,r.useState)(!1),[g,v]=(0,r.useState)(!1),[w,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(0,n.MI)();e?(d(e.pubkey),v(!0)):v(!1),u((0,n.Ru)()),(0,n.SX)().then(m).catch(()=>m(!1)),(async()=>{try{if((null==e?void 0:e.scheme)==="device"){let e=await (0,n.s6)();h(e),u(!0)}}catch(e){}})();let t=()=>{let e=(0,n.MI)();e&&(d(e.pubkey),v(!0))};return window.addEventListener("dope:store",t),()=>{window.removeEventListener("dope:store",t)}},[]),(0,r.useEffect)(()=>{N(!0)},[]);let b=async e=>{let t=await (0,n.Z9)(e);return d(t.address),v(!0),t},j=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"phantom",a=arguments.length>3?arguments[3]:void 0,r="string"==typeof s&&s.startsWith("m/"),l=r?await (0,n.ir)(e,t,s,a):await (0,n.o4)(e,t,s,a);return d(l.address),v(!0),l},y=async(e,t)=>{let a=null,r=e.trim();try{if(r.startsWith("[")){let e=JSON.parse(r);Array.isArray(e)&&(a=new Uint8Array(e.map(e=>Number(e))))}else if(/^[A-Za-z0-9+/=]+$/.test(r)&&r.includes("=")){let e=atob(r),t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);a=t}else/^[1-9A-HJ-NP-Za-km-z]+$/.test(r)&&(a=i().decode(r))}catch(e){}if(!a)throw Error("Invalid keypair input. Paste JSON array, base58, or base64 secret key.");let{importWalletFromSecretKey:l}=await Promise.resolve().then(s.bind(s,3861)),n=await l(a,t);return d(n.address),v(!0),n},f=async e=>{let t=await (0,n.fK)(e);h(t),u(!0)},S=async()=>{if(!p)return!1;let e=await (0,n.B9)();return!!(e&&(0,n.Ru)())&&(u(!0),!0)};return(0,a.jsx)(c.Provider,{value:{address:l,unlocked:x,keypair:o,hasWallet:g,ready:w,createWallet:b,importWallet:j,importKeypair:y,unlock:f,tryBiometricUnlock:S,lock:()=>{h(null),u(!1)},logout:()=>{h(null),(0,n.QD)(),u(!1),d(null),v(!1)}},children:t})}function o(){let e=(0,r.useContext)(c);if(!e)throw Error("useWallet must be used within WalletProvider");return e}function h(){return(0,r.useContext)(c)}}},function(e){e.O(0,[814,727,847,711,971,596,744],function(){return e(e.s=618)}),_N_E=e.O()}]);