(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[396],{5586:function(e,t,a){Promise.resolve().then(a.bind(a,9250))},9250:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(7437),n=a(2265),i=a(1396),l=a.n(i),s=a(9265);function o(){let{address:e}=(0,s.Os)(),[t,a]=(0,n.useState)("crypto"),[i,o]=(0,n.useState)(""),[c,u]=(0,n.useState)(""),[d,p]=(0,n.useState)(null),[h,x]=(0,n.useState)(!1),[m,f]=(0,n.useState)(""),[y,w]=(0,n.useState)("");(0,n.useEffect)(()=>{let e=Number(i);if(!Number.isFinite(e)||e<=0){p(null);return}let t=1*e;p(Math.max(0,t-.005*t-.005*t))},[i]);let b=async()=>{if(w(""),f(""),!e){w("No wallet");return}if("crypto"===t){let t=Number(i);if(!Number.isFinite(t)||t<=0){w("Enter a valid amount");return}if(t<.01){w("Minimum 0.01 DOPE");return}x(!0);try{let a=await fetch("/api/card/topup",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({pubkey:e,amount:t})}).then(e=>e.json());if(!a.ok)throw Error(a.error||"Top-up failed");f("Credited ".concat((a.credited||0).toFixed(2)," USDC")),o("")}catch(e){w((null==e?void 0:e.message)||"Failed to top-up")}finally{x(!1)}}else{let t=Number(c);if(!Number.isFinite(t)||t<=0){w("Enter a valid USD amount");return}if(t<1){w("Minimum $1");return}x(!0);try{let a=/iphone|ipad|mac/i.test(navigator.userAgent)?"apple":"google",r=await fetch("/api/card/topup-fiat",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({pubkey:e,amountUsd:t,provider:a})}).then(e=>e.json());if(!(null==r?void 0:r.ok))throw Error((null==r?void 0:r.error)||"Fiat top-up failed");f("Credited ".concat((r.credited||0).toFixed(2)," USDC via ").concat("apple"===a?"Apple Pay":"Google Pay")),u("")}catch(e){w((null==e?void 0:e.message)||"Failed to top-up (fiat)")}finally{x(!1)}}};return(0,r.jsxs)("div",{className:"space-y-6 pb-24",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold",children:"Top Up Card"}),(0,r.jsxs)("div",{className:"glass rounded-2xl p-5 border border-white/10 space-y-3",children:[(0,r.jsxs)("div",{className:"flex gap-2 text-sm",children:[(0,r.jsx)("button",{className:"px-3 py-2 rounded-full ".concat("crypto"===t?"bg-white text-black":"bg-white/10 text-white"),onClick:()=>a("crypto"),children:"Crypto (DOPE â†’ USDC)"}),(0,r.jsx)("button",{className:"px-3 py-2 rounded-full ".concat("fiat"===t?"bg-white text-black":"bg-white/10 text-white"),onClick:()=>a("fiat"),children:"Card (Apple/Google Pay)"})]}),"crypto"===t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-xs text-white/60",children:"Amount in DOPE"}),(0,r.jsx)("input",{inputMode:"decimal",value:i,onChange:e=>o(e.target.value.replace(/[^0-9.]/g,"").replace(/(\..*?)\..*/,"$1")),placeholder:"0.00",className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-3 outline-none text-lg"}),null!==d&&(0,r.jsxs)("div",{className:"text-sm text-white/70",children:["Est. receive: ",(0,r.jsxs)("span",{className:"font-semibold text-white",children:[d.toFixed(2)," USDC"]})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-xs text-white/60",children:"Amount (USD)"}),(0,r.jsx)("input",{inputMode:"decimal",value:c,onChange:e=>u(e.target.value.replace(/[^0-9.]/g,"").replace(/(\..*?)\..*/,"$1")),placeholder:"0.00",className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-3 outline-none text-lg"}),(0,r.jsx)("div",{className:"text-xs text-white/60",children:"Charged via Apple Pay / Google Pay, credited as USDC to your card (minus ~1.5% fee)."})]}),y&&(0,r.jsx)("div",{className:"text-xs text-red-400",children:y}),m&&(0,r.jsx)("div",{className:"text-xs text-green-400",children:m}),(0,r.jsx)("button",{className:"btn w-full",onClick:b,disabled:h||("crypto"===t?!i:!c),children:h?"Processing...":"Top Up Card"}),"crypto"===t?(0,r.jsx)("div",{className:"text-xs text-white/60",children:"This is a development stub. In production, this will require a DOPE token transfer to the CardVault program and on-chain swap to USDC with slippage protection."}):(0,r.jsx)("div",{className:"text-xs text-white/60",children:"Apple/Google Pay requires merchant configuration. This call is currently stubbed to credit your demo card balance."})]}),(0,r.jsx)("div",{className:"text-sm",children:(0,r.jsx)(l(),{href:"/wallet/card",className:"underline",children:"Back to Card"})})]})}},9265:function(e,t,a){"use strict";a.d(t,{Ek:function(){return d},Os:function(){return u},nS:function(){return c}});var r=a(7437),n=a(2265),i=a(8870),l=a.n(i),s=a(3861);let o=(0,n.createContext)(null);function c(e){let{children:t}=e,[i,c]=(0,n.useState)(null),[u,d]=(0,n.useState)(null),[p,h]=(0,n.useState)((0,s.Ru)()),[x,m]=(0,n.useState)(!1),[f,y]=(0,n.useState)(!1),[w,b]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=(0,s.MI)();e?(c(e.pubkey),y(!0)):y(!1),h((0,s.Ru)()),(0,s.SX)().then(m).catch(()=>m(!1)),(async()=>{try{if((null==e?void 0:e.scheme)==="device"){let e=await (0,s.s6)();d(e),h(!0)}}catch(e){}})();let t=()=>{let e=(0,s.MI)();e&&(c(e.pubkey),y(!0))};return window.addEventListener("dope:store",t),()=>{window.removeEventListener("dope:store",t)}},[]),(0,n.useEffect)(()=>{b(!0)},[]);let g=async e=>{let t=await (0,s.Z9)(e);return c(t.address),y(!0),t},v=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"phantom",r=arguments.length>3?arguments[3]:void 0,n="string"==typeof a&&a.startsWith("m/"),i=n?await (0,s.ir)(e,t,a,r):await (0,s.o4)(e,t,a,r);return c(i.address),y(!0),i},N=async(e,t)=>{let r=null,n=e.trim();try{if(n.startsWith("[")){let e=JSON.parse(n);Array.isArray(e)&&(r=new Uint8Array(e.map(e=>Number(e))))}else if(/^[A-Za-z0-9+/=]+$/.test(n)&&n.includes("=")){let e=atob(n),t=new Uint8Array(e.length);for(let a=0;a<e.length;a++)t[a]=e.charCodeAt(a);r=t}else/^[1-9A-HJ-NP-Za-km-z]+$/.test(n)&&(r=l().decode(n))}catch(e){}if(!r)throw Error("Invalid keypair input. Paste JSON array, base58, or base64 secret key.");let{importWalletFromSecretKey:i}=await Promise.resolve().then(a.bind(a,3861)),s=await i(r,t);return c(s.address),y(!0),s},S=async e=>{let t=await (0,s.fK)(e);d(t),h(!0)},j=async()=>{if(!x)return!1;let e=await (0,s.B9)();return!!(e&&(0,s.Ru)())&&(h(!0),!0)};return(0,r.jsx)(o.Provider,{value:{address:i,unlocked:p,keypair:u,hasWallet:f,ready:w,createWallet:g,importWallet:v,importKeypair:N,unlock:S,tryBiometricUnlock:j,lock:()=>{d(null),h(!1)},logout:()=>{d(null),(0,s.QD)(),h(!1),c(null),y(!1)}},children:t})}function u(){let e=(0,n.useContext)(o);if(!e)throw Error("useWallet must be used within WalletProvider");return e}function d(){return(0,n.useContext)(o)}}},function(e){e.O(0,[814,727,847,711,971,596,744],function(){return e(e.s=5586)}),_N_E=e.O()}]);