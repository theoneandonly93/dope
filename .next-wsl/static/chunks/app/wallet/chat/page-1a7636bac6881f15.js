(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[813],{6347:function(e,t,s){Promise.resolve().then(s.bind(s,3080))},3080:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var a=s(7437),r=s(2265),l=s(7133),n=s(9265),i=s(3861);function c(){let{keypair:e,address:t,unlocked:s}=(0,n.Os)(),[c,o]=(0,r.useState)(""),[u,d]=(0,r.useState)(""),[h,f]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),[p,w]=(0,r.useState)(null),[y,v]=(0,r.useState)(""),[b,g]=(0,r.useState)(null),[N,j]=(0,r.useState)([]),[S,k]=(0,r.useState)(""),C=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=(0,i.MI)();o((null==e?void 0:e.scheme)||"")},[]),(0,r.useEffect)(()=>{var e;null===(e=C.current)||void 0===e||e.scrollTo({top:C.current.scrollHeight,behavior:"smooth"})},[N.length]);let E=async()=>{f("");try{let e=await (0,i.lv)("password"===c?u:void 0),t=await (0,i.IC)(e);w(t.secretKey),x(l.Buffer.from(t.publicKey).toString("base64"))}catch(e){f((null==e?void 0:e.message)||"Failed to derive chat keys")}},A=async()=>{try{let e=await (0,i.BD)(y.trim());g(e)}catch(e){g(null)}};(0,r.useEffect)(()=>{y&&A()},[y]),(0,r.useEffect)(()=>{if(!t||!y||!p||!m)return;let e=!0,s=async()=>{try{let s=await (0,i.cc)(t,y,p,m);e&&j(s.map(e=>({id:e.id,from:e.from,text:e.text,at:e.time})))}catch(e){}};s();let a=setInterval(s,15e3);return()=>{e=!1,clearInterval(a)}},[t,y,p,m]);let I=async()=>{if(e&&m)try{await (0,i.e$)(e,m)}catch(e){console.error(e)}},P=async s=>{if(null==s||s.preventDefault(),!e||!p||!m){f("Unlock chat first");return}let a=S.trim();if(a&&y)try{await (0,i.$p)(e,p,m,y,a),k(""),setTimeout(async()=>{if(!t)return;let e=await (0,i.cc)(t,y,p,m);j(e.map(e=>({id:e.id,from:e.from,text:e.text,at:e.time})))},1200)}catch(e){f((null==e?void 0:e.message)||"Failed to send")}},R="password"===c&&(!p||!m);return(0,a.jsxs)("div",{className:"flex flex-col gap-3 min-h-[calc(100vh-180px)]",children:[(0,a.jsxs)("div",{className:"glass rounded-2xl p-3 border border-white/10 space-y-2",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:"Direct Message"}),(0,a.jsx)("input",{className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 outline-none",placeholder:"Recipient wallet address",value:y,onChange:e=>v(e.target.value)}),(0,a.jsx)("div",{className:"text-xs text-white/60",children:y?b?"Recipient chat key found.":"Recipient has not published a chat key yet.":"Enter a wallet address to start."})]}),(0,a.jsxs)("div",{className:"glass rounded-2xl p-3 border border-white/10 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:"Your Chat Key"}),(0,a.jsx)("div",{className:"text-xs text-white/60 break-all max-w-[50%]",children:m?m.slice(0,10)+"â€¦"+m.slice(-6):"Not derived"})]}),R&&(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)("input",{type:"password",value:u,onChange:e=>d(e.target.value),placeholder:"Wallet password",className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 outline-none"}),(0,a.jsx)("button",{className:"btn",onClick:E,children:"Unlock Chat"})]}),!R&&!m&&(0,a.jsx)("button",{className:"btn w-full",onClick:E,children:"Generate Chat Keys"}),m&&(0,a.jsx)("button",{className:"btn w-full",onClick:I,children:"Publish Chat Key"}),h&&(0,a.jsx)("div",{className:"text-xs text-red-400",children:h})]}),(0,a.jsx)("div",{ref:C,className:"flex-1 overflow-y-auto space-y-2 pr-1",children:N.map(e=>(0,a.jsx)("div",{className:"flex ".concat("me"===e.from?"justify-end":"justify-start"),children:(0,a.jsx)("div",{className:"max-w-[80%] rounded-2xl px-3 py-2 text-sm ".concat("me"===e.from?"bg-white text-black":"glass border border-white/10"),children:e.text})},e.id))}),(0,a.jsxs)("form",{onSubmit:P,className:"flex items-center gap-2",children:[(0,a.jsx)("input",{className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-3 outline-none",placeholder:"Message",value:S,onChange:e=>k(e.target.value)}),(0,a.jsx)("button",{type:"submit",className:"btn",children:"Send"})]})]})}},9265:function(e,t,s){"use strict";s.d(t,{Ek:function(){return d},Os:function(){return u},nS:function(){return o}});var a=s(7437),r=s(2265),l=s(8870),n=s.n(l),i=s(3861);let c=(0,r.createContext)(null);function o(e){let{children:t}=e,[l,o]=(0,r.useState)(null),[u,d]=(0,r.useState)(null),[h,f]=(0,r.useState)((0,i.Ru)()),[m,x]=(0,r.useState)(!1),[p,w]=(0,r.useState)(!1),[y,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(0,i.MI)();e?(o(e.pubkey),w(!0)):w(!1),f((0,i.Ru)()),(0,i.SX)().then(x).catch(()=>x(!1)),(async()=>{try{if((null==e?void 0:e.scheme)==="device"){let e=await (0,i.s6)();d(e),f(!0)}}catch(e){}})();let t=()=>{let e=(0,i.MI)();e&&(o(e.pubkey),w(!0))};return window.addEventListener("dope:store",t),()=>{window.removeEventListener("dope:store",t)}},[]),(0,r.useEffect)(()=>{v(!0)},[]);let b=async e=>{let t=await (0,i.Z9)(e);return o(t.address),w(!0),t},g=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"phantom",a=arguments.length>3?arguments[3]:void 0,r="string"==typeof s&&s.startsWith("m/"),l=r?await (0,i.ir)(e,t,s,a):await (0,i.o4)(e,t,s,a);return o(l.address),w(!0),l},N=async(e,t)=>{let a=null,r=e.trim();try{if(r.startsWith("[")){let e=JSON.parse(r);Array.isArray(e)&&(a=new Uint8Array(e.map(e=>Number(e))))}else if(/^[A-Za-z0-9+/=]+$/.test(r)&&r.includes("=")){let e=atob(r),t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);a=t}else/^[1-9A-HJ-NP-Za-km-z]+$/.test(r)&&(a=n().decode(r))}catch(e){}if(!a)throw Error("Invalid keypair input. Paste JSON array, base58, or base64 secret key.");let{importWalletFromSecretKey:l}=await Promise.resolve().then(s.bind(s,3861)),i=await l(a,t);return o(i.address),w(!0),i},j=async e=>{let t=await (0,i.fK)(e);d(t),f(!0)},S=async()=>{if(!m)return!1;let e=await (0,i.B9)();return!!(e&&(0,i.Ru)())&&(f(!0),!0)};return(0,a.jsx)(c.Provider,{value:{address:l,unlocked:h,keypair:u,hasWallet:p,ready:y,createWallet:b,importWallet:g,importKeypair:N,unlock:j,tryBiometricUnlock:S,lock:()=>{d(null),f(!1)},logout:()=>{d(null),(0,i.QD)(),f(!1),o(null),w(!1)}},children:t})}function u(){let e=(0,r.useContext)(c);if(!e)throw Error("useWallet must be used within WalletProvider");return e}function d(){return(0,r.useContext)(c)}}},function(e){e.O(0,[814,727,711,971,596,744],function(){return e(e.s=6347)}),_N_E=e.O()}]);