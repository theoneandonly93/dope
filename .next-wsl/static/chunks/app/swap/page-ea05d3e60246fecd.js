(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[998],{1082:function(e,t,n){Promise.resolve().then(n.bind(n,4705))},4705:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var a=n(7437),s=n(2265),r=n(9265),i=n(3438),l=n(3861),o=n(7133).Buffer;let c="So11111111111111111111111111111111111111112",u="EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v";function d(){let{address:e,keypair:t}=(0,r.Os)(),[n,d]=(0,s.useState)(c),[h,p]=(0,s.useState)(u),[x,w]=(0,s.useState)(""),[f,m]=(0,s.useState)(null),[b,v]=(0,s.useState)(""),[g,y]=(0,s.useState)(!1),[S,j]=(0,s.useState)(!1),[N,k]=(0,s.useState)(""),C=!!t&&!!e,E=async()=>{v(""),m(null),y(!0);try{let e="/api/swap/quote?in=".concat(encodeURIComponent(n),"&out=").concat(encodeURIComponent(h),"&amount=").concat(encodeURIComponent(x||"0")),t=await fetch(e,{cache:"no-store"}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"HTTP ".concat(t.status));m(a)}catch(e){v((null==e?void 0:e.message)||"Quote failed")}finally{y(!1)}},P=async()=>{if(!t||!e){v("Unlock wallet first");return}let a=Number(x);if(!(a>0)){v("Enter amount");return}v(""),j(!0),k("");try{let s=await fetch("/api/swap/prepare",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({inputMint:n,outputMint:h,amount:a,slippageBps:50,userPublicKey:e})}),r=await s.json();if(!s.ok)throw Error((null==r?void 0:r.error)||"HTTP ".concat(s.status));let c=null==r?void 0:r.swapTransaction;if(!c)throw Error("No transaction");let u=o.from(c,"base64"),d=i.GS.deserialize(u);d.sign([t]);let p=new i.ew((0,l.vw)(),{commitment:"confirmed"}),x=await p.sendRawTransaction(d.serialize(),{skipPreflight:!1,maxRetries:3});k(x)}catch(e){v((null==e?void 0:e.message)||"Swap failed")}finally{j(!1)}};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"Swap"}),(0,a.jsxs)("div",{className:"glass rounded-2xl p-3 border border-white/10 space-y-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-white/60 mb-1",children:"From"}),(0,a.jsxs)("select",{value:n,onChange:e=>d(e.target.value),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 outline-none text-sm",children:[(0,a.jsx)("option",{value:c,children:"SOL"}),(0,a.jsx)("option",{value:u,children:"USDC"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-white/60 mb-1",children:"To"}),(0,a.jsxs)("select",{value:h,onChange:e=>p(e.target.value),className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 outline-none text-sm",children:[(0,a.jsx)("option",{value:u,children:"USDC"}),(0,a.jsx)("option",{value:c,children:"SOL"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-white/60 mb-1",children:"Amount"}),(0,a.jsx)("input",{value:x,onChange:e=>w(e.target.value.replace(/[^0-9.]/g,"").replace(/(\..*?)\..*/,"$1")),placeholder:"0.00",className:"w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 outline-none"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"btn btn-xs",onClick:E,disabled:g||!x,children:g?"Loading...":"Get Quote"}),(0,a.jsx)("button",{className:"btn btn-xs",onClick:()=>{let e="https://jup.ag/swap/".concat(n,"-").concat(h);try{window.open(e,"_blank")}catch(t){location.href=e}},children:"Open in Jupiter"}),(0,a.jsx)("button",{className:"btn btn-xs",onClick:P,disabled:S||!C||!x,children:S?"Swapping...":"Swap"})]}),b&&(0,a.jsx)("div",{className:"text-xs text-red-400",children:b}),f&&(0,a.jsxs)("div",{className:"text-xs text-white/70",children:["Best quote via Jupiter. Price impact: ",f.priceImpactPct?(100*f.priceImpactPct).toFixed(2):"â€”","%."]}),N&&(0,a.jsxs)("div",{className:"text-xs text-green-400 break-all",children:["Submitted: ",N," ",(0,a.jsx)("a",{className:"underline",href:"https://explorer.solana.com/tx/".concat(N),target:"_blank",rel:"noreferrer",children:"view"})]})]}),(0,a.jsx)("div",{className:"text-xs text-white/60",children:"Note: In-app swap execution will be enabled when aggregator access is configured. For now, use the Jupiter link for secure swaps."})]})}},9265:function(e,t,n){"use strict";n.d(t,{Ek:function(){return d},Os:function(){return u},nS:function(){return c}});var a=n(7437),s=n(2265),r=n(8870),i=n.n(r),l=n(3861);let o=(0,s.createContext)(null);function c(e){let{children:t}=e,[r,c]=(0,s.useState)(null),[u,d]=(0,s.useState)(null),[h,p]=(0,s.useState)((0,l.Ru)()),[x,w]=(0,s.useState)(!1),[f,m]=(0,s.useState)(!1),[b,v]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=(0,l.MI)();e?(c(e.pubkey),m(!0)):m(!1),p((0,l.Ru)()),(0,l.SX)().then(w).catch(()=>w(!1)),(async()=>{try{if((null==e?void 0:e.scheme)==="device"){let e=await (0,l.s6)();d(e),p(!0)}}catch(e){}})();let t=()=>{let e=(0,l.MI)();e&&(c(e.pubkey),m(!0))};return window.addEventListener("dope:store",t),()=>{window.removeEventListener("dope:store",t)}},[]),(0,s.useEffect)(()=>{v(!0)},[]);let g=async e=>{let t=await (0,l.Z9)(e);return c(t.address),m(!0),t},y=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"phantom",a=arguments.length>3?arguments[3]:void 0,s="string"==typeof n&&n.startsWith("m/"),r=s?await (0,l.ir)(e,t,n,a):await (0,l.o4)(e,t,n,a);return c(r.address),m(!0),r},S=async(e,t)=>{let a=null,s=e.trim();try{if(s.startsWith("[")){let e=JSON.parse(s);Array.isArray(e)&&(a=new Uint8Array(e.map(e=>Number(e))))}else if(/^[A-Za-z0-9+/=]+$/.test(s)&&s.includes("=")){let e=atob(s),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);a=t}else/^[1-9A-HJ-NP-Za-km-z]+$/.test(s)&&(a=i().decode(s))}catch(e){}if(!a)throw Error("Invalid keypair input. Paste JSON array, base58, or base64 secret key.");let{importWalletFromSecretKey:r}=await Promise.resolve().then(n.bind(n,3861)),l=await r(a,t);return c(l.address),m(!0),l},j=async e=>{let t=await (0,l.fK)(e);d(t),p(!0)},N=async()=>{if(!x)return!1;let e=await (0,l.B9)();return!!(e&&(0,l.Ru)())&&(p(!0),!0)};return(0,a.jsx)(o.Provider,{value:{address:r,unlocked:h,keypair:u,hasWallet:f,ready:b,createWallet:g,importWallet:y,importKeypair:S,unlock:j,tryBiometricUnlock:N,lock:()=>{d(null),p(!1)},logout:()=>{d(null),(0,l.QD)(),p(!1),c(null),m(!1)}},children:t})}function u(){let e=(0,s.useContext)(o);if(!e)throw Error("useWallet must be used within WalletProvider");return e}function d(){return(0,s.useContext)(o)}}},function(e){e.O(0,[814,727,711,971,596,744],function(){return e(e.s=1082)}),_N_E=e.O()}]);