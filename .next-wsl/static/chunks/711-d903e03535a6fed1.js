(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[711],{6601:function(){},2361:function(){},4616:function(){},5024:function(){},8745:function(e,t,n){"use strict";n.d(t,{Fz:function(){return a}});var r=n(2601);let a=r.env.NEXT_PUBLIC_DOPE_MINT||"FGiXdp7TAggF1Jux4EQRGoSjdycQR1jwYnvFBWbSLX33"},3861:function(e,t,n){"use strict";n.d(t,{$p:function(){return ey},AG:function(){return L},B5:function(){return Q},B9:function(){return em},BD:function(){return ef},Cp:function(){return q},EJ:function(){return H},IC:function(){return ec},KR:function(){return j},LJ:function(){return U},MI:function(){return _},MX:function(){return C},QD:function(){return R},Ru:function(){return N},SX:function(){return ep},Tf:function(){return k},Vx:function(){return ee},Z9:function(){return D},_f:function(){return Z},cc:function(){return ew},e$:function(){return ed},fK:function(){return O},h8:function(){return I},iB:function(){return et},importWalletFromSecretKey:function(){return J},ir:function(){return W},lv:function(){return el},n5:function(){return S},o4:function(){return F},q7:function(){return eu},ql:function(){return eb},s6:function(){return eA},sm:function(){return T},tU:function(){return en},vw:function(){return Y},yZ:function(){return $}});var r=n(1016),a=n(7963),i=n.n(a),o=n(6503),c=n(3438),l=n(8745),u=n(7133);n(2601);let s="dope_wallet_v1",d="dope_wallet_device_secret",f="dope_wallet_session_unlocked",y=new TextEncoder,w=new TextDecoder;function p(e){let t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(e),t}function m(e){let t=e instanceof ArrayBuffer?new Uint8Array(e):e,n="";return t.forEach(e=>n+=String.fromCharCode(e)),btoa(n)}function h(e){let t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}async function g(e,t,n){let r=await crypto.subtle.importKey("raw",p(y.encode(e)),"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:p(t),iterations:n},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function v(e,t){let n=crypto.getRandomValues(new Uint8Array(16)),r=crypto.getRandomValues(new Uint8Array(12)),a=await g(t,n,25e4),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:p(r)},a,p(y.encode(e)));return{algo:"AES-GCM",iv:m(r),salt:m(n),iterations:25e4,cipherText:m(i)}}async function b(e,t){let n=h(e.salt),r=h(e.iv),a=await g(t,n,e.iterations),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:p(r)},a,p(h(e.cipherText)));return w.decode(i)}function A(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,t=crypto.getRandomValues(new Uint8Array(e/8)),n=Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("");return r.JJ(n)}let S=[{key:"phantom",label:"Phantom / Backpack (m/44'/501'/0'/0')",path:"m/44'/501'/0'/0'"},{key:"sollet",label:"Sollet (m/44'/501'/0')",path:"m/44'/501'/0'"},{key:"ledger_alt",label:"Ledger/Backpack Alt (m/44'/501'/0'/0'/0')",path:"m/44'/501'/0'/0'/0'"}];async function k(e,t,n){if(!r._I(e))throw Error("Invalid mnemonic");let a=await r.OI(e,n||""),l=(0,o.derivePath)(t,u.Buffer.from(a).toString("hex")),s=i().sign.keyPair.fromSeed(new Uint8Array(l.key));return c.RG.fromSecretKey(s.secretKey)}async function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r="m/44'/501'/".concat(t,"'/0'");return k(e,r,n)}function M(){let e=crypto.getRandomValues(new Uint8Array(8));return Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")}function P(){return{version:2,wallets:[]}}function K(){let e=localStorage.getItem(s);if(!e)return P();try{let t=JSON.parse(e);if(t&&2===t.version&&Array.isArray(t.wallets))return t;if(t&&"object"==typeof t&&"encMnemonic"in t&&"pubkey"in t){let e=M(),n={version:2,wallets:[{...t,id:e}],selectedId:e};return B(n),n}}catch(e){}return P()}function B(e){localStorage.setItem(s,JSON.stringify(e));try{window.dispatchEvent(new CustomEvent("dope:store"))}catch(e){}}function C(){return K().wallets}function I(){let e=K();if(0===e.wallets.length)return null;let t=e.wallets.find(t=>t.id===e.selectedId)||e.wallets[0];return t||null}function T(e){let t=K();t.wallets.find(t=>t.id===e)&&(t.selectedId=e,B(t))}function x(e){let t=K(),n=t.wallets.findIndex(e=>e.id===t.selectedId),r=n>=0?n:0;t.wallets[r]&&(e(t.wallets[r]),B(t))}function U(e){x(t=>{t.name=e.trim()||void 0})}function _(){let e=I();return e?{encMnemonic:e.encMnemonic,pubkey:e.pubkey,createdAt:e.createdAt,biometricEnabled:e.biometricEnabled,scheme:e.scheme,derivationPath:e.derivationPath,bip39PassphraseEnc:e.bip39PassphraseEnc,encSecretKey:e.encSecretKey}:null}function G(e,t){let n=K(),r={...e,id:M(),name:t};n.wallets.push(r),n.selectedId=r.id,B(n)}function R(){localStorage.removeItem(s),sessionStorage.removeItem(f)}function N(){return"1"===sessionStorage.getItem(f)}function V(){sessionStorage.setItem(f,"1")}async function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"phantom",n=A(128),r=S.find(e=>e.key===t)||S[0],a=await k(n,r.path),i=await v(n,e),o={encMnemonic:i,pubkey:a.publicKey.toBase58(),createdAt:Date.now(),scheme:"password",derivationPath:r.path};return G(o),{mnemonic:n,address:o.pubkey}}async function F(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"phantom",r=arguments.length>3?arguments[3]:void 0,a=S.find(e=>e.key===n)||S[0],i=await k(e,a.path,r),o=await v(e,t),c={encMnemonic:o,pubkey:i.publicKey.toBase58(),createdAt:Date.now(),scheme:"password",derivationPath:a.path,bip39PassphraseEnc:r?await v(r,t):void 0};return G(c),{address:c.pubkey}}async function W(e,t,n,r){let a=await k(e,n,r),i=await v(e,t),o={encMnemonic:i,pubkey:a.publicKey.toBase58(),createdAt:Date.now(),scheme:"password",derivationPath:n,bip39PassphraseEnc:r?await v(r,t):void 0};return G(o),{address:o.pubkey}}async function J(e,t){let n=e instanceof Uint8Array?e:new Uint8Array(e),r=c.RG.fromSecretKey(n),a=m(n),i=await v(a,t),o={algo:"AES-GCM",iv:m(new Uint8Array(12)),salt:m(new Uint8Array(16)),iterations:0,cipherText:m(new Uint8Array(0))},l={encMnemonic:o,encSecretKey:i,pubkey:r.publicKey.toBase58(),createdAt:Date.now(),scheme:"raw"};return G(l),{address:l.pubkey}}async function O(e){let t;let n=_();if(!n)throw Error("No wallet on this device");if("raw"===n.scheme&&n.encSecretKey){let r=await b(n.encSecretKey,e),a=atob(r),i=new Uint8Array(a.length);for(let e=0;e<a.length;e++)i[e]=a.charCodeAt(e);t=c.RG.fromSecretKey(i)}else{let r;let a=await b(n.encMnemonic,e);if(n.bip39PassphraseEnc)try{r=await b(n.bip39PassphraseEnc,e)}catch(e){}t=n.derivationPath?await k(a,n.derivationPath,r):await E(a,0,r)}return V(),t}async function q(e,t){let n=I();if(!n)throw Error("No active wallet");if("password"!==n.scheme)throw Error("Wallet does not use password");let r=await b(n.encMnemonic,e),a=await v(r,t);x(e=>{e.encMnemonic=a,e.scheme="password"})}async function L(e){let t=I();if(!t)throw Error("No active wallet");if("device"!==t.scheme)throw Error("Wallet already has password");let n=await ev(t.encMnemonic),r=await v(n,e);x(e=>{e.encMnemonic=r,e.scheme="password"})}let X="dope_network";function j(){try{{let e=localStorage.getItem(X);if("devnet"===e||"testnet"===e||"mainnet"===e)return e}}catch(e){}return"mainnet"}function H(e){try{localStorage.setItem(X,e)}catch(e){}}function Y(){let e=j(),t=window.location?window.location.origin:"";return"".concat(t,"/api/rpc?net=").concat(e)}function Q(){let e=Y(),t=void 0,n="confirmed";return t?new c.ew(e,{commitment:n,wsEndpoint:t}):new c.ew(e,n)}function z(e){return e/1e9}async function Z(e){try{var t,n,r;let a=Q(),i=new c.nh(e),o=new c.nh(l.Fz),u=await a.getParsedTokenAccountsByOwner(i,{mint:o});if(!u||0===u.value.length)return 0;let s=u.value[0].account.data,d=null==s?void 0:null===(r=s.parsed)||void 0===r?void 0:null===(n=r.info)||void 0===n?void 0:null===(t=n.tokenAmount)||void 0===t?void 0:t.uiAmount;return"number"==typeof d?d:0}catch(e){return 0}}async function $(e){let t=Q();try{let n=await t.getBalance(new c.nh(e));return z(n)}catch(e){return 0}}async function ee(e,t,n){let r=Q(),a=new c.YW().add(c.yc.transfer({fromPubkey:e.publicKey,toPubkey:new c.nh(t),lamports:Math.round(1e9*n)})),i=await r.sendTransaction(a,[e]);return i}function et(e,t){let n=Q();try{let r=n.onAccountChange(new c.nh(e),e=>{t(z(e.lamports))},"confirmed");return()=>{try{n.removeAccountChangeListener(r)}catch(e){}}}catch(e){return()=>{}}}async function en(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=Q(),r=new c.nh(e),a=[];try{a=await n.getSignaturesForAddress(r,{limit:t})}catch(e){return[]}if(0===a.length)return[];let i=[];try{i=await n.getParsedTransactions(a.map(e=>e.signature),{maxSupportedTransactionVersion:0})}catch(e){return[]}let o=[];for(let t=0;t<a.length;t++){let n=a[t],r=i[t],c=null,l="unknown",u=n.blockTime||null;if(r&&r.meta){let t=r.transaction.message.accountKeys.findIndex(t=>{var n,r,a;return("pubkey"in t?null===(n=(r=t.pubkey).toBase58)||void 0===n?void 0:n.call(r):null===(a=t.toBase58)||void 0===a?void 0:a.call(t))===e});if(t>=0&&r.meta.preBalances&&r.meta.postBalances){let e=r.meta.preBalances[t],n=r.meta.postBalances[t];c=z(n-e)}let n=r.meta.err;l=n?"error":"success",null==u&&r.blockTime&&(u=r.blockTime)}o.push({signature:n.signature,slot:n.slot,time:u,change:c,status:l})}return o}let er="dopechat:pub:",ea="dopechat:msg:",ei=new c.nh("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr");async function eo(e){let t=await crypto.subtle.digest("SHA-256",y.encode(e));return new Uint8Array(t)}async function ec(e){let t=await eo("dope-chat-v1|"+e),n=t.slice(0,32),r=i().box.keyPair.fromSecretKey(n);return r}async function el(e){let t=_();if(!t)throw Error("No wallet on this device");if("device"===t.scheme)return await ev(t.encMnemonic);if("password"===t.scheme){if(!e)throw Error("Password required for chat");return await b(t.encMnemonic,e)}throw Error("Unsupported wallet scheme")}async function eu(e){let t=await el(e),n=await E(t),r="",a=n.secretKey;for(let e=0;e<a.length;e++)r+=String.fromCharCode(a[e]);let i=btoa(r);return{mnemonic:t,secretKeyB64:i}}function es(e){return new c.Sl({keys:[],programId:ei,data:u.Buffer.from(e,"utf8")})}async function ed(e,t){let n=Q(),r="".concat(er).concat(t),a=new c.YW().add(es(r));return await n.sendTransaction(a,[e])}async function ef(e){let t=Q(),n=new c.nh(e),r=await t.getSignaturesForAddress(n,{limit:50});if(0===r.length)return null;let a=await t.getParsedTransactions(r.map(e=>e.signature),{maxSupportedTransactionVersion:0});for(let e=0;e<a.length;e++){var i,o,l;let t=a[e];if(!t)continue;let n=t.transaction.message.instructions||[];for(let e of n){let t=e.programId||void 0,n=e.program,r=(null===(l=e.parsed)||void 0===l?void 0:null===(o=l.params)||void 0===o?void 0:o[0])||e.data||void 0;if("spl-memo"===n){let t=e.parsed||r;if("string"==typeof t&&t.startsWith(er))return t.slice(er.length)}t&&t.toBase58&&(t.toBase58(),ei.toBase58())}let r=(null===(i=t.meta)||void 0===i?void 0:i.logMessages)||void 0;if(r)for(let e of r){let t=e.indexOf(er);if(t>=0)return e.slice(t+er.length).trim()}}return null}async function ey(e,t,n,r,a){if(a.length>220)throw Error("Message too long (max 220 chars)");let o=await ef(r);if(!o)throw Error("Recipient has not published chat key");let l=h(o),u=crypto.getRandomValues(new Uint8Array(24)),s=y.encode(a),d=i().box(s,u,l,t),f={v:1,to:o,from:n,nonce:m(u),box:m(d)},w=btoa(JSON.stringify(f)),p="".concat(ea).concat(w),g=Q(),v=new c.YW().add(es(p)),b=await g.sendTransaction(v,[e]);return b}async function ew(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:40,o=Q(),l=await o.getSignaturesForAddress(new c.nh(e),{limit:a}),u=await o.getSignaturesForAddress(new c.nh(t),{limit:a}),s=new Map;for(let e of[...l,...u])s.set(e.signature,e.slot);let d=Array.from(s.keys());if(0===d.length)return[];let f=await o.getParsedTransactions(d,{maxSupportedTransactionVersion:0}),y=[];for(let e=0;e<f.length;e++){var p;let t=f[e];if(!t)continue;let a=(null===(p=t.meta)||void 0===p?void 0:p.logMessages)||void 0,o=null;if(a)for(let e of a){let t=e.indexOf(ea);if(t>=0){o=e.slice(t+ea.length).trim();break}}if(o)try{let e=JSON.parse(atob(o));if(!e||e.to!==r)continue;let a=h(e.nonce),c=h(e.box),l=h(e.from),u=i().box.open(c,a,l,n);if(!u)continue;let s=w.decode(u),d=e.from!==r;y.push({id:t.transaction.signatures[0],from:d?"them":"me",text:s,time:t.blockTime||null})}catch(e){}}return y.sort((e,t)=>(e.time||0)-(t.time||0)),y}async function ep(){try{var e,t;if(!window.PublicKeyCredential)return!1;let n=await (null===(e=(t=PublicKeyCredential).isUserVerifyingPlatformAuthenticatorAvailable)||void 0===e?void 0:e.call(t));return!!n}catch(e){return!1}}async function em(e){try{if(!window.PublicKeyCredential)return!1;let t=crypto.getRandomValues(new Uint8Array(32)),n={challenge:t,userVerification:"required"};e&&(n.allowCredentials=[{id:e,type:"public-key"}]);let r=await navigator.credentials.get({publicKey:n});return!!r}catch(e){return!1}}function eh(){let e=localStorage.getItem(d);if(!e){let t=crypto.getRandomValues(new Uint8Array(32));e=m(t),localStorage.setItem(d,e)}return h(e)}async function eg(e){let t=eh(),n=crypto.getRandomValues(new Uint8Array(12)),r=await crypto.subtle.importKey("raw",p(t),"AES-GCM",!1,["encrypt"]),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:p(n)},r,p(y.encode(e)));return{algo:"AES-GCM",iv:m(n),salt:m(new Uint8Array(0)),iterations:0,cipherText:m(a)}}async function ev(e){let t=eh(),n=h(e.iv),r=await crypto.subtle.importKey("raw",p(t),"AES-GCM",!1,["decrypt"]),a=await crypto.subtle.decrypt({name:"AES-GCM",iv:p(n)},r,p(h(e.cipherText)));return w.decode(a)}async function eb(){let e=A(128),t=S[0].path,n=await k(e,t),r=await eg(e),a={encMnemonic:r,pubkey:n.publicKey.toBase58(),createdAt:Date.now(),scheme:"device",derivationPath:t};return G(a),V(),{mnemonic:e,address:a.pubkey,keypair:n}}async function eA(){let e=_();if(!e)throw Error("No wallet on this device");let t=await ev(e.encMnemonic),n=e.derivationPath?await k(t,e.derivationPath):await E(t);return V(),n}}}]);